<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test...</title>
</head>
<body>

<script>


// 生成一个 128 位的 AES 密钥
crypto.subtle.generateKey(
    {
        name: "AES-CBC",
        length: 128
    },
    true,
    ["encrypt", "decrypt"]
).then(function(key) {
    // 加密函数
    function encryptData(data, key) {
        return crypto.subtle.encrypt(
            {
                name: "AES-CBC",
                iv: crypto.getRandomValues(new Uint8Array(16)) // 生成随机的 16 字节的初始化向量
            },
            key,
            new TextEncoder().encode(data)
        );
    }

    // 解密函数
    function decryptData(data, key) {
        return crypto.subtle.decrypt(
            {
                name: "AES-CBC",
                iv: crypto.getRandomValues(new Uint8Array(16)) // 生成随机的 16 字节的初始化向量
            },
            key,
            data
        ).then(function(decrypted) {
            return new TextDecoder().decode(decrypted);
        });
    }

    const dataToEncrypt = "Hello, this is a secret message!";
    encryptData(dataToEncrypt, key).then(function(encryptedData) {
        console.log("Encrypted data: ", new Uint8Array(encryptedData));

        decryptData(encryptedData, key).then(function(decryptedMessage) {
            console.log("Decrypted message: ", decryptedMessage);
        });
    });
});
        
</script>
        
</body>
</html>